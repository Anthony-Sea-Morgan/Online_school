{% extends 'index.html' %}

{% block title %}
–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
{% endblock %}

{% block page_label %}
–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
{% endblock %}

{% block header %}
{% include "header.html" %}
{% endblock %}


{% block content %}
<div style="display: block;background-image: url('https://img.freepik.com/free-vector/topographic-contour-lines-map-seamless-pattern_1284-52862.jpg?t=st=1686950979~exp=1686951579~hmac=2c9c70a24bea4d4196297c64e44526ceda26ce5d09203cd56a6cb02e5736bd5e');">
<div class="courses-base" style="display:flex;height: max-content; min-height: max-content;">
 <div class="personal-calendar-align">
<table class="personal-calendar" id="calendar">
 <thead>
    <tr><td>‚Äπ<td colspan="5"><td>‚Ä∫
    <tr><td>–ü–Ω<td>–í—Ç<td>–°—Ä<td>–ß—Ç<td>–ü—Ç<td>–°–±<td>–í—Å
  <tbody>
</table>
</div>
</div>
    <div class="courses-base" style="display:flex;">
<div class="courses-base" style="display:flex;width: 65%">
    <div class="courses-list-align">
    <h1>–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è</h1>
    {% for date, lessons in grouped_lessons.items %}
    <div class="date-unit-wrapper ib va">
        <h4> {{ date }}</h4>
        {% for lesson in lessons %}
        <div class="date-unit-lesson">
            <h2>{{ lesson.title }}</h2>
            <h5>{{ lesson.start_time }}</h5>
        </div>
        {% endfor %}
    </div>
    {% empty %}
    <p>–∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p>
    {% endfor %}
</div>
</div>
</div>

<div class="courses-base" style="display:flex;">

    <div class="courses-base" style="width: 80%">
        <div style="width: 100%; height: 100%;justify-content: center;display: flex;">
        <div class="courses-list-wrapper jc-c">
            <div class="courses-list-align">
                                {% if request.user.is_mentor%}
                <h2 style="color: black; text-align: center">–í–∞—à–∏ –∫—É—Ä—Å—ã:</h2>
                {% else %}
                <h2 style="color: black; text-align: center">–ò–º–µ—é—â–∏–µ—Å—è –∫—É—Ä—Å—ã:</h2>
                {% endif %}
                {% for course in user.courses.all %}
                <div class="courses-unit-wrapper ib va" data-technology="{{ course.technologies }}" data-difficulty="{{ course.difficulty }}" style="background: linear-gradient(1deg, #fffcfa7d, #ededed);">
                    <!--background: linear-gradient(1deg, #ffad5a47, #ffad5a);-->
                    <!--background: linear-gradient(1deg, #ffad5a7d, #ededed);-->
                    <div class="courses-unit-texture">
                        <div class="courses-unit-rating ws-nw va">{{ course.rating }}<img src="/static/dist/img/PNG/icon/rating.png" alt="/static/dist/img/PNG/icon/rating.png" class="icn"></div>
                        <div class="courses-unit-title"><h2 style="background-color: #ffffff00;"><strong>{{ course.title }}</strong></h2></div>
                        <div class="courses-unit-difficulty">{{ course.difficulty }}</div>
                         <div class="courses-unit-shortdes">{{ course.short_des }}</div>
                        {% if request.user.is_mentor%}<div class="courses-unit-a-management"><button onclick="location.href='{% url 'management:lessons_list' course.id %}'" class="btn" >üõ†Ô∏è</button></div>{% endif %}
                        <div class="courses-unit-a"><button onclick="location.href='{% url 'course_lessons' course.id %}'" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–Ω—è—Ç–∏—è–º ‚Üí</button></div>
                    </div>

                </div>
                {% empty %}
                <p>–ù–µ—Ç –∏–º–µ—é—â–∏—Ö—Å—è –∫—É—Ä—Å–æ–≤</p>
                {% endfor %}
            </div>
        </div>
    </div>
    </div>


</div>
</div>
<div class="courses-filter-wrapper" style="left:0;">

<select class="form__input" id="technology-filter">

   {% for tech in technology %}
    <option value="{{ tech }}">{{ tech }}</option>
  {% endfor %}
                 </select>
        <select class="form__input" id="difficulty-filter">
   {% for diffic in difficulty %}
    <option value="{{ diffic }}">{{ diffic }}</option>
  {% endfor %}
              </select>

    </div>
<div class="courses-filter-wrapper" style="right:15px">

        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ:</h3>
        <p>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: {{ user.username }}</p>
        <p>–ò–º—è: {{ user.first_name }}</p>
        <p>–§–∞–º–∏–ª–∏—è: {{ user.last_name }}</p>
        <p>Email: {{ user.email }}</p>
        <p>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: {{ user.phone_number }}</p>
        <button id="edit-profile" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        {% if not request.user.is_mentor%}
        <h4>–ö–æ—à–µ–ª–µ–∫:</h4>
        <p>–ë–∞–ª–∞–Ω—Å: {{ user.wallet }}</p>
        <button id="edit-wallet" class="btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
        {% endif %}
</div>


{% include "edit_profile.html" %}
{% include "wallet_replenishment.html" %}
{% endblock %}
{% block script %}
<script>
  var selectedDates = [];
function Calendar(id, year, month) {
var Dlast = new Date(year,month+1,0).getDate(),
    D = new Date(year,month,Dlast),
    DNlast = new Date(D.getFullYear(),D.getMonth(),Dlast).getDay(),
    DNfirst = new Date(D.getFullYear(),D.getMonth(),1).getDay(),
    calendar = '<tr>',
    month=["–Ø–Ω–≤–∞—Ä—å","–§–µ–≤—Ä–∞–ª—å","–ú–∞—Ä—Ç","–ê–ø—Ä–µ–ª—å","–ú–∞–π","–ò—é–Ω—å","–ò—é–ª—å","–ê–≤–≥—É—Å—Ç","–°–µ–Ω—Ç—è–±—Ä—å","–û–∫—Ç—è–±—Ä—å","–ù–æ—è–±—Ä—å","–î–µ–∫–∞–±—Ä—å"];
if (DNfirst != 0) {
  for(var  i = 1; i < DNfirst; i++) calendar += '<td>';
}else{
  for(var  i = 0; i < 6; i++) calendar += '<td>';
}
for(var  i = 1; i <= Dlast; i++) {
  if (i == new Date().getDate() && D.getFullYear() == new Date().getFullYear() && D.getMonth() == new Date().getMonth()) {
    calendar += '<td class="today">' + i;
  }else{
    calendar += '<td>' + i;
  }
  if (new Date(D.getFullYear(),D.getMonth(),i).getDay() == 0) {
    calendar += '<tr>';
  }
}
for(var  i = DNlast; i < 7; i++) calendar += '<td>&nbsp;';
document.querySelector('#'+id+' tbody').innerHTML = calendar;
document.querySelector('#'+id+' thead td:nth-child(2)').innerHTML = month[D.getMonth()] +' '+ D.getFullYear();
document.querySelector('#'+id+' thead td:nth-child(2)').dataset.month = D.getMonth();
document.querySelector('#'+id+' thead td:nth-child(2)').dataset.year = D.getFullYear();
if (document.querySelectorAll('#'+id+' tbody tr').length < 6) {  // —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–∏ –º–µ—Å—è—Ü–µ–≤ –Ω–µ "–ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–ª–∞" –≤—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä—è–¥ –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫. –ò—Ç–æ–≥: –≤—Å–µ–≥–¥–∞ 6 —Å—Ç—Ä–æ–∫ –¥–ª—è —Ü–∏—Ñ—Ä
    document.querySelector('#'+id+' tbody').innerHTML += '<tr><td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;';
}
 highlightCalendarDays();
}
Calendar("calendar", new Date().getFullYear(), new Date().getMonth());
// –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–∏–Ω—É—Å –º–µ—Å—è—Ü
document.querySelector('#calendar thead tr:nth-child(1) td:nth-child(1)').onclick = function() {
  Calendar("calendar", document.querySelector('#calendar thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar thead td:nth-child(2)').dataset.month)-1);
}
// –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø–ª—é—Å –º–µ—Å—è—Ü
document.querySelector('#calendar thead tr:nth-child(1) td:nth-child(3)').onclick = function() {
  Calendar("calendar", document.querySelector('#calendar thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar thead td:nth-child(2)').dataset.month)+1);
}




 function highlightCalendarDays() {
        var calendarDays = document.querySelectorAll('.personal-calendar td');

        calendarDays.forEach(function (calendarDay) {
            var calendarDate = new Date(
                document.querySelector('#calendar thead td:nth-child(2)').dataset.year,
                parseFloat(document.querySelector('#calendar thead td:nth-child(2)').dataset.month),
                parseInt(calendarDay.textContent, 10)
            );

            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –≤ 00:00, —á—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞—Ç—ã
            calendarDate.setHours(0, 0, 0, 0);

            // –ï—Å–ª–∏ –¥–∞—Ç–∞ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö, —Ç–æ –≤—ã–¥–µ–ª—è–µ–º —è—á–µ–π–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            if (selectedDates.includes(calendarDate.getTime())) {
                calendarDay.style.background = 'rgba(255, 165, 0, 0.5)'; // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Å—Ç–∏–ª—å –≤—ã–¥–µ–ª–µ–Ω–∏—è
            } else {
                calendarDay.style.background = 'none';
            }
        });
    }

    function parseCustomDate(dateString) {
        var months = {
            '—è–Ω–≤–∞—Ä—è': 0, '—Ñ–µ–≤—Ä–∞–ª—è': 1, '–º–∞—Ä—Ç–∞': 2, '–∞–ø—Ä–µ–ª—è': 3,
            '–º–∞—è': 4, '–∏—é–Ω—è': 5, '–∏—é–ª—è': 6, '–∞–≤–≥—É—Å—Ç–∞': 7,
            '—Å–µ–Ω—Ç—è–±—Ä—è': 8, '–æ–∫—Ç—è–±—Ä—è': 9, '–Ω–æ—è–±—Ä—è': 10, '–¥–µ–∫–∞–±—Ä—è': 11
        };
        var dateParts = dateString.split(' ');
        var day = parseInt(dateParts[0], 10);
        var month = months[dateParts[1]];
        var year = parseInt(dateParts[2], 10);
        return new Date(year, month, day);
    }

    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–∞—Ç—ã –∏–∑ –≥—Ä—É–ø–ø —É—Ä–æ–∫–æ–≤
    var lessonDates = document.querySelectorAll('.date-unit-wrapper.ib.va h4');

    lessonDates.forEach(function (lessonDate) {
        var date = parseCustomDate(lessonDate.textContent.trim());

        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –≤ 00:00, —á—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞—Ç—ã
        date.setHours(0, 0, 0, 0);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –≤ —Å–ø–∏—Å–æ–∫
        selectedDates.push(date.getTime());
    });

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —è—á–µ–µ–∫ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
    highlightCalendarDays();

</script>
<script src="/static/dist/js/coursesFilter.js"></script>
<script src="/static/dist/js/userEdit.js"></script>
{% endblock %}



